---
import { Icon } from 'astro-icon/components'
import Search from '@components/Search.astro'

const navItems = [
	{ title: 'Inicio', href: '/' },
	{ title: 'Blog', href: '/blog' },
	{ title: 'Portafolio', href: '/portafolio' }
]

const isActive = (path: string) => {
	const currentPath = Astro.url.pathname
	return currentPath === path || (path !== '/' && currentPath.startsWith(path))
}
---

<header class="fixed top-0 z-50 w-full">
	<div
		class="bg-dark/70 mx-auto flex h-16 max-w-screen-xl items-center justify-between px-4 backdrop-blur-md"
	>
		<!-- Logo -->
		<a href="/" class="flex items-center space-x-2">
			<img
				src="/img/logo.svg"
				alt="Steve Moya"
				width="40"
				height="40"
				class="transition-transform duration-300 hover:scale-110"
			/>
		</a>

		<!-- Desktop Navigation -->
		<nav class="hidden items-center space-x-6 md:flex">
			{
				navItems.map((item) => (
					<a
						href={item.href}
						class={`text-sm font-medium transition-colors duration-300 ${
							isActive(item.href)
								? 'text-[#c70039]'
								: 'text-white/80 hover:text-[#c70039]'
						}`}
					>
						{item.title}
					</a>
				))
			}
		</nav>

		<!-- Right Side: Search & Mobile Menu -->
		<div class="flex items-center space-x-4">
			<!-- Search Component -->
			<div class="flex items-center">
				<Search />
			</div>

			<!-- Mobile Menu Button -->
			<button
				id="mobile-menu-button"
				type="button"
				aria-label="MenÃº"
				class="p-2 text-white/80 transition-colors hover:text-[#c70039] md:hidden"
			>
				<Icon name="mdi:menu" class="h-5 w-5" id="menu-icon" />
				<Icon name="mdi:close" class="hidden h-5 w-5" id="close-icon" />
			</button>
		</div>
	</div>

	<!-- Mobile Navigation -->
	<div
		id="mobile-menu"
		class="bg-dark/95 fixed inset-0 z-50 flex translate-y-[-100%] transform flex-col items-center justify-center backdrop-blur-lg transition-transform duration-300"
	>
		<nav class="flex flex-col items-center space-y-8 py-8">
			{
				navItems.map((item) => (
					<a
						href={item.href}
						class="text-xl font-medium text-white/80 transition-colors hover:text-[#c70039]"
					>
						{item.title}
					</a>
				))
			}
		</nav>
	</div>
</header>

<script>
	// Mobile menu functionality
	const mobileMenuButton = document.getElementById('mobile-menu-button')
	const mobileMenu = document.getElementById('mobile-menu')
	const menuIcon = document.getElementById('menu-icon')
	const closeIcon = document.getElementById('close-icon')

	mobileMenuButton?.addEventListener('click', () => {
		const isOpen = mobileMenu?.style.transform === 'translateY(0%)'

		if (isOpen && mobileMenu && menuIcon && closeIcon) {
			mobileMenu.style.transform = 'translateY(-100%)'
			menuIcon.classList.remove('hidden')
			closeIcon.classList.add('hidden')
		} else if (mobileMenu && menuIcon && closeIcon) {
			mobileMenu.style.transform = 'translateY(0%)'
			menuIcon.classList.add('hidden')
			closeIcon.classList.remove('hidden')
		}
	})

	// Close mobile menu when clicking on a link
	const mobileNavLinks = mobileMenu?.querySelectorAll('a')
	mobileNavLinks?.forEach((link) => {
		link.addEventListener('click', () => {
			if (mobileMenu && menuIcon && closeIcon) {
				mobileMenu.style.transform = 'translateY(-100%)'
				menuIcon.classList.remove('hidden')
				closeIcon.classList.add('hidden')
			}
		})
	})

	// Handle scroll behavior - show shadow on scroll
	const header = document.querySelector('header')
	let lastScrollY = window.scrollY

	window.addEventListener('scroll', () => {
		if (window.scrollY > 20) {
			header?.classList.add('shadow-md')
		} else {
			header?.classList.remove('shadow-md')
		}

		lastScrollY = window.scrollY
	})
</script>

---
import { Icon } from 'astro-icon/components'
import { getPosts } from '@src/utils/post'
import { formatDate } from '@src/utils'
import { siteConfig } from '@src/data/config'
import Layout from '@src/layouts/Layout.astro'
import socialLinks from '@src/data/socialLinks.json'
import Particles from '@components/Hero/Particles.astro'
// Obtener los últimos 3 posts y el post más reciente
const latestPosts = await getPosts(3)
const mostRecentPost = latestPosts.length > 0 ? latestPosts[0] : null

// Imagen de perfil y otros datos
const { author, profileImage } = siteConfig
---

<Layout
	title={`${author} | Enlaces`}
	description="Enlaces a mis redes sociales y últimos artículos"
>
<div class="relative flex min-h-screen w-full flex-col items-center justify-start px-4 py-16 bg-[#080810]">
		<!-- Botón compartir -->
		<button
			id="share-button"
			class="absolute top-4 right-4 z-20 flex items-center justify-center rounded-full bg-[#1f1f1f]/80 p-2 text-white transition-all duration-300 hover:bg-[#c70039] hover:shadow-lg border border-white/5 backdrop-blur-sm"
			aria-label="Compartir"
			title="Compartir esta página"
		>
			<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5">
				<path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
				<polyline points="16 6 12 2 8 6"></polyline>
				<line x1="12" y1="2" x2="12" y2="15"></line>
			</svg>
		</button>
   
		<!-- Avatar y nombre -->
		<div class="mb-6 flex flex-col items-center relative z-10">
			<div class="relative">
				<img
					src={profileImage}
					alt={author}
					class="h-28 w-28 rounded-full border-4 border-[#c70039] object-cover shadow-lg shadow-[#c70039]/10"
				/>
				<div class="absolute -inset-1 bg-gradient-to-r from-[#c70039] to-[#840025] rounded-full blur-xl opacity-20 -z-10"></div>
			</div>
			<h1 class="mt-4 font-monoton text-3xl font-bold text-white">{author}</h1>
			<p class="mt-2 text-sm text-gray-300">Marketer & Frontend Developer</p>


			<!-- Iconos de redes sociales en círculos -->
			<div class="mt-4 flex flex-wrap justify-center gap-4 relative z-10">
				{
					socialLinks.links 
						.map((link) => (
                            link.url.startsWith('https') ? (
							<a
								href={link.url}
								target={link.url.startsWith('https') ? '_blank' : '_self'}
								rel={link.url.startsWith('https') ? 'noopenzer noreferrer' : ''}
								class="flex h-10 w-10 items-center justify-center rounded-full bg-[#1f1f1f] text-white transition-all duration-300 hover:bg-[#c70039] hover:shadow-lg hover:shadow-[#c70039]/20"
								aria-label={link.title}
								title={link.title}
							>
								<Icon name={link.icon} class="h-5 w-5" />
							</a>
                            ) : null
						))
				}
			</div>
		</div>

		{mostRecentPost && (
			<>
				<!-- Divider para artículo destacado -->
				<div class="my-6 flex w-full max-w-md items-center">
					<div class="h-px flex-1 bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>
					<span class="px-4 text-sm font-medium text-white/60">Mi artículo más reciente</span>
					<div class="h-px flex-1 bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>
				</div>
				
				<!-- Artículo más reciente destacado -->
				<a
					href={`/blog/${mostRecentPost.slug}`}
					class="group mb-6 w-full max-w-md overflow-hidden rounded-xl bg-[#1f1f1f]/80 shadow-lg transition-all duration-300 hover:shadow-xl hover:shadow-[#c70039]/10 border border-white/5"
				>
					{mostRecentPost.data.heroImage?.src && (
						<div class="relative h-48 w-full overflow-hidden">
							<img
								src={mostRecentPost.data.heroImage.src}
								alt={mostRecentPost.data.title}
								class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"
							/>
							<div class="absolute inset-0 bg-gradient-to-t from-[#101010]/90 to-transparent"></div>
						</div>
					)}
					<div class="p-5">
						<h3 class="text-lg font-bold text-white group-hover:text-[#c70039] transition-colors">
							{mostRecentPost.data.title}
						</h3>
						<p class="mt-2 line-clamp-2 text-sm text-gray-300">
							{mostRecentPost.data.description}
						</p>
						<div class="mt-4 flex items-center justify-between">
							<span class="text-xs text-[#c70039]">
								{formatDate(mostRecentPost.data.pubDate)}
							</span>
							<span class="flex items-center text-xs text-white/70">
								<Icon name="mdi:eye" class="mr-1 h-4 w-4" />
								Leer artículo
							</span>
						</div>
					</div>
				</a>
			</>
		)}

		<!-- Enlaces sociales -->
		<div class="w-full max-w-md space-y-3">
			{
				socialLinks.links.map((link) => (
					<a
						href={link.url}
						target={link.url.startsWith('http') ? '_blank' : '_self'}
						rel={link.url.startsWith('http') ? 'noopener noreferrer' : ''}
						class="group flex w-full items-center justify-between rounded-lg bg-[#1f1f1f]/80 px-5 py-4 backdrop-blur-sm transition-all duration-300 hover:bg-[#c70039]/80 hover:shadow-lg border border-white/5"
					>
						<span class="flex items-center gap-3 font-medium text-white">
							<Icon name={link.icon} class="h-6 w-6" />
							{link.title}
						</span>
						<Icon
							name="mdi:arrow-right"
							class="h-5 w-5 transform text-white transition-transform duration-300 group-hover:translate-x-1"
						/>
					</a>
				))
			}
		</div>

		<!-- Divider -->
		<div class="my-8 flex w-full max-w-md items-center">
			<div class="h-px flex-1 bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>
			<span class="px-4 text-sm font-medium text-white/60">Últimos artículos</span>
			<div class="h-px flex-1 bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>
		</div>

		<!-- Últimos artículos - Diseño Bento Box -->
		<div class="grid w-full max-w-md gap-3 sm:grid-cols-2">
			{latestPosts.map((post, index) => {
				// El primer elemento ocupa todo el ancho en móvil, y más alto en desktop si hay más de 1 post
				const isFirstItem = index === 0;
				const hasMultiplePosts = latestPosts.length > 1;
				
				return (
					<a
						href={`/blog/${post.slug}`}
						class={`group flex flex-col overflow-hidden rounded-xl bg-[#1f1f1f]/80 backdrop-blur-sm transition-all duration-300 hover:shadow-lg hover:shadow-[#c70039]/10 border border-white/5 ${
							isFirstItem && hasMultiplePosts ? 'sm:col-span-2 sm:aspect-[21/9]' : 'aspect-square sm:aspect-auto'
						}`}
					>
						{post.data.heroImage?.src ? (
							<div class="relative flex-1 overflow-hidden">
								<img
									src={post.data.heroImage.src}
									alt={post.data.title}
									class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"
								/>
								<div class="absolute inset-0 bg-gradient-to-t from-[#101010]/90 to-transparent"></div>
								<div class="absolute bottom-0 left-0 p-4 w-full">
									<p class="text-xs font-medium text-[#c70039] mb-1">
										{formatDate(post.data.pubDate)}
									</p>
									<h3 class={`font-bold text-white group-hover:text-[#c70039] transition-colors line-clamp-2 ${
										isFirstItem && hasMultiplePosts ? 'text-lg sm:text-xl' : 'text-base'
									}`}>
										{post.data.title}
									</h3>
								</div>
							</div>
						) : (
							<div class="flex h-full flex-col justify-between p-4">
								<div>
									<h3 class={`font-bold text-white group-hover:text-[#c70039] transition-colors ${
										isFirstItem && hasMultiplePosts ? 'text-lg sm:text-xl' : 'text-base'
									}`}>
										{post.data.title}
									</h3>
									<p class="mt-2 line-clamp-2 text-xs text-gray-300">
										{post.data.description}
									</p>
								</div>
								<p class="mt-4 text-xs text-[#c70039]">
									{formatDate(post.data.pubDate)}
								</p>
							</div>
						)}
					</a>
				);
			})}
		</div>
	</div>
    <Particles />
</Layout>

<style>
	/* Efectos modernos de fondo con flares y patrones */
	@keyframes float-flares {
		0% { background-position: 0% 0%; }
		25% { background-position: 25% 10%; }
		50% { background-position: 10% 20%; }
		75% { background-position: 15% 5%; }
		100% { background-position: 0% 0%; }
	}
	
	.relative.flex.min-h-screen {
		position: relative;
		isolation: isolate;
	}
	
	/* Fondo base con patrón de puntos */
	.relative.flex.min-h-screen::before {
		content: "";
		position: absolute;
		inset: 0;
		background-image: 
			radial-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 2px);
		background-size: 30px 30px;
		opacity: 0.4;
		z-index: -2;
	}
	
	/* Flares y gradientes */
	.relative.flex.min-h-screen::after {
		content: "";
		position: absolute;
		inset: 0;
		background: 
			radial-gradient(circle at 75% 10%, rgba(199, 0, 57, 0.25) 0%, transparent 50%),
			radial-gradient(circle at 10% 85%, rgba(199, 0, 57, 0.15) 0%, transparent 60%),
			radial-gradient(circle at 90% 90%, rgba(30, 60, 110, 0.1) 0%, transparent 40%),
			radial-gradient(circle at 20% 20%, rgba(30, 30, 50, 0.15) 0%, transparent 55%),
			linear-gradient(135deg, rgba(10,10,15,0.95) 0%, rgba(25,25,30,0.95) 100%);
		z-index: -1;
		animation: float-flares 20s ease-in-out infinite;
		filter: blur(30px);
	}

	/* Animaciones para entrada */
	@keyframes fadeUp {
		from {
			opacity: 0;
			transform: translateY(20px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	/* Aplicar animaciones a elementos */
	h1,
	p,
	a,
	div,
	img,
	span {
		animation: fadeUp 0.5s ease-out forwards;
		opacity: 0;
	}
	
	/* Efectos para las cards */
	a.group {
		position: relative;
		box-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.2), 0 2px 8px -1px rgba(0, 0, 0, 0.1);
		backdrop-filter: blur(10px);
		transition: transform 0.3s ease, box-shadow 0.3s ease;
	}
	
	a.group:hover {
		transform: translateY(-2px);
		box-shadow: 0 8px 30px -2px rgba(0, 0, 0, 0.3), 0 0 15px -3px rgba(199, 0, 57, 0.15);
	}
	
	/* Animación especial para artículo destacado */
	a.group.mb-6 {
		animation: fadeUp 0.7s ease-out forwards;
		opacity: 0;
		position: relative;
	}
	
	a.group.mb-6::before {
		content: '';
		position: absolute;
		top: -1px;
		left: -1px;
		right: -1px;
		bottom: -1px;
		background: linear-gradient(45deg, rgba(199, 0, 57, 0.3), transparent 60%);
		border-radius: inherit;
		z-index: -1;
		opacity: 0;
		transition: opacity 0.3s ease;
	}
	
	a.group.mb-6:hover::before {
		opacity: 1;
	}
	
	a.group.mb-6 img {
		transition: transform 0.5s ease;
	}

	/* Retrasos escalonados */
	img {
		animation-delay: 0s;
	}
	h1 {
		animation-delay: 0.1s;
	}
	p:first-of-type {
		animation-delay: 0.2s;
	}
	p:nth-of-type(2) {
		animation-delay: 0.25s;
	}
	
	/* Iconos sociales circulares */
	.mt-3.flex.flex-wrap a:nth-child(1) {
		animation-delay: 0.3s;
	}
	.mt-3.flex.flex-wrap a:nth-child(2) {
		animation-delay: 0.35s;
	}
	.mt-3.flex.flex-wrap a:nth-child(3) {
		animation-delay: 0.4s;
	}
	.mt-3.flex.flex-wrap a:nth-child(4) {
		animation-delay: 0.45s;
	}
	.mt-3.flex.flex-wrap a:nth-child(5) {
		animation-delay: 0.5s;
	}
	
	/* Artículo destacado */
	.my-6.flex {
		animation-delay: 0.6s;
	}
	a.group.mb-6 {
		animation-delay: 0.7s;
	}
	
	/* Enlaces principales */
	div:nth-of-type(4) a:nth-child(1) {
		animation-delay: 0.8s;
	}
	div:nth-of-type(4) a:nth-child(2) {
		animation-delay: 0.85s;
	}
	div:nth-of-type(4) a:nth-child(3) {
		animation-delay: 0.9s;
	}
	div:nth-of-type(4) a:nth-child(4) {
		animation-delay: 0.95s;
	}
	div:nth-of-type(4) a:nth-child(5) {
		animation-delay: 1s;
	}
	div:nth-of-type(4) a:nth-child(6) {
		animation-delay: 1.05s;
	}
	div:nth-of-type(4) a:nth-child(7) {
		animation-delay: 1.1s;
	}
	
	/* Últimos artículos - Bento Box */
	.grid a:nth-child(1) {
		animation-delay: 1.2s;
	}
	.grid a:nth-child(2) {
		animation-delay: 1.3s;
	}
	.grid a:nth-child(3) {
		animation-delay: 1.4s;
	}
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const shareButton = document.getElementById('share-button');
    
    if (shareButton) {
      shareButton.addEventListener('click', async () => {
        try {
          // Verificar si el navegador soporta Web Share API
          if (navigator.share && navigator.canShare) {
            const shareData = {
              title: document.title,
              text: 'Echa un vistazo a este perfil',
              url: window.location.href
            };
            
            // Verificar si los datos son válidos para compartir
            if (navigator.canShare(shareData)) {
              await navigator.share(shareData);
              return;
            }
          }
          
          // Fallback: copiar al portapapeles
          if (navigator.clipboard && window.isSecureContext) {
            await navigator.clipboard.writeText(window.location.href);
          } else {
            // Fallback para contextos no seguros
            const textArea = document.createElement('textarea');
            textArea.value = window.location.href;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
          }
          
          // Mostrar feedback visual temporal
          const originalContent = shareButton.innerHTML;
          shareButton.innerHTML = '<span class="text-green-400 text-sm">¡Copiado!</span>';
          setTimeout(() => {
            shareButton.innerHTML = originalContent;
          }, 2000);
          
        } catch (error) {
          if (error && error.name !== 'AbortError') {
            console.error('Error al compartir:', error);
            // Mostrar feedback de error
            const originalContent = shareButton.innerHTML;
            shareButton.innerHTML = '<span class="text-red-400 text-sm">Error</span>';
            setTimeout(() => {
              shareButton.innerHTML = originalContent;
            }, 2000);
          }
        }
      });
    }
  });
</script>
